name: ğŸ“° Daily Tech News Aggregator v2.0

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´æ—©ä¸Š8ç‚¹è¿è¡Œ (UTC 0ç‚¹)
    - cron: '0 0 * * *'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      enable_translation:
        description: 'å¯ç”¨ç¿»è¯‘åŠŸèƒ½'
        required: false
        default: true
        type: boolean

jobs:
  collect-tech-news:
    runs-on: ubuntu-latest
    
    steps:
    # 1. æ£€å‡ºä»£ç 
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    # 2. è®¾ç½®Pythonç¯å¢ƒ
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
    
    # 3. å®‰è£…ä¾èµ–
    - name: ğŸ“¦ Install Dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    # 4. é…ç½®Git
    - name: âš™ï¸ Configure Git
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Tech News Bot"
    
    # 5. è¿è¡Œæ–°é—»æ”¶é›† (v2.1 GitHubä¼˜åŒ–ç‰ˆ)
    - name: ğŸ” Collect Premium Tech News (GitHub Optimized)
      env:
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        GMAIL_USER: ${{ secrets.GMAIL_USER }}
        GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}
        RECIPIENT_EMAIL: ${{ secrets.RECIPIENT_EMAIL }}
        ENABLE_TRANSLATION: ${{ github.event.inputs.enable_translation || 'true' }}
        GITHUB_ACTIONS: true
      run: |
        echo "ğŸš€ å¼€å§‹æ”¶é›†é«˜è´¨é‡ç§‘æŠ€èµ„è®¯ (v2.1 GitHubä¼˜åŒ–ç‰ˆ)..."
        echo "ğŸ¯ ä¸“æ³¨äº”å¤§æ ¸å¿ƒé¢†åŸŸï¼šGitHubã€AIã€åˆ›ä¸šã€ç¡…è°·ã€ç§‘æŠ€"
        echo "ğŸ›¡ï¸ å¢å¼ºé”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶"
        python main.py
    
    # 6. æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
    - name: ğŸ“„ Check Generated Files
      run: |
        echo "ğŸ“ æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶:"
        ls -la output/ || echo "outputç›®å½•ä¸å­˜åœ¨"
        ls -la *.md || echo "æ²¡æœ‰æ‰¾åˆ°markdownæ–‡ä»¶"
    
    # 7. æäº¤æ›´æ”¹åˆ°ä»“åº“
    - name: ğŸ’¾ Commit Changes
      run: |
        git add .
        if git diff --staged --quiet; then
          echo "æ²¡æœ‰æ–°çš„æ›´æ”¹éœ€è¦æäº¤"
        else
          git commit -m "ğŸ“° Daily tech news update - $(date +'%Y-%m-%d %H:%M:%S')"
          git push
          echo "âœ… æ›´æ”¹å·²æäº¤å¹¶æ¨é€"
        fi
    
    # 8. ä¸Šä¼ æŠ¥å‘Šä½œä¸ºArtifacts
    - name: ğŸ“¤ Upload Reports
      uses: actions/upload-artifact@v3
      with:
        name: daily-reports-${{ github.run_number }}
        path: |
          output/*.md
          latest_report.md
        retention-days: 30

# å·¥ä½œæµæƒé™
permissions:
  contents: write
  actions: read 