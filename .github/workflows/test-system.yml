name: ğŸ§ª Test News System

on:
  workflow_dispatch:
    inputs:
      test_sources:
        description: 'æµ‹è¯•RSSæºæ•°é‡'
        required: false
        default: '3'

jobs:
  test-collection:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: ğŸ“¦ Install Dependencies
      run: |
        pip install -r requirements.txt
    
    - name: ğŸ§ª Test RSS Collection
      run: |
        echo "æµ‹è¯•RSSæ”¶é›†åŠŸèƒ½..."
        python -c "
        from main import TechNewsAggregator
        aggregator = TechNewsAggregator()
        # åªæµ‹è¯•å‰3ä¸ªæº
        aggregator.rss_sources = aggregator.rss_sources[:3]
        news = aggregator._collect_rss_data()
        print(f'æµ‹è¯•å®Œæˆï¼Œæ”¶é›†åˆ° {len(news)} æ¡æ–°é—»')
        "
    
    - name: ğŸ§ª Test Report Generation
      env:
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
      run: |
        echo "æµ‹è¯•æŠ¥å‘Šç”ŸæˆåŠŸèƒ½..."
        python -c "
        from report_generator import ReportGenerator
        generator = ReportGenerator(enable_translation=False)
        test_data = [{'title': 'Test News', 'summary': 'Test summary', 'url': 'http://test.com', 'source': 'Test', 'time': '2024-01-01'}]
        versions = generator.generate_all_versions(test_data)
        print('æŠ¥å‘Šç”Ÿæˆæµ‹è¯•å®Œæˆ')
        print(f'è‹±æ–‡ç‰ˆé•¿åº¦: {len(versions[\"english\"])}')
        print(f'æ’­å®¢ç‰ˆé•¿åº¦: {len(versions[\"podcast\"])}')
        " 